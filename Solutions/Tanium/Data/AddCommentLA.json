{
  "type": "Microsoft.Logic/workflows",
  "apiVersion": "2017-07-01",
  "name": "AddCommentTanium",
  "location": "[parameters('workspace-location')]",
  "properties": {
    "state": "Enabled",
    "definition": {
      "$schema": "https://schema.@{variables('azureManagementUrl')}/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
	"$connections": {
	  "defaultValue": {},
	  "type": "Object"
	}
      },
      "triggers": {
	"manual": {
	  "type": "Request",
	  "kind": "Http",
	  "inputs": {
	    "method": "POST",
	    "schema": {
	      "properties": {
		"arm_id": {
		  "type": "string"
		},
		"message": {
		  "type": "string"
		}
	      },
	      "type": "object"
	    }
	  }
	}
      },
      "actions": {
	"Add_comment_to_incident_(V3)": {
	  "runAfter": {
	    "Get_incident": [
	      "Succeeded"
	    ]
	  },
	  "type": "ApiConnection",
	  "inputs": {
	    "body": {
	      "incidentArmId": "@body('Get_incident')?['id']",
	      "message": "<p>@{triggerBody()?['message']}</p>"
	    },
	    "host": {
	      "connection": {
		"name": "@parameters('$connections')['azuresentinel']['connectionId']"
	      }
	    },
	    "method": "post",
	    "path": "/Incidents/Comment"
	  }
	},
	"Get_incident": {
	  "runAfter": {},
	  "type": "ApiConnection",
	  "inputs": {
	    "body": {
	      "incidentArmId": "@triggerBody()?['arm_id']"
	    },
	    "host": {
	      "connection": {
		"name": "@parameters('$connections')['azuresentinel']['connectionId']"
	      }
	    },
	    "method": "post",
	    "path": "/Incidents"
	  }
	}
      },
      "outputs": {}
    },
    "parameters": {
      "$connections": {
        "value": {
          "azuresentinel": {
            "connectionId": "[resourceId('Microsoft.Web/connections', parameters('playbook1-ConnectionName'))]",
            "connectionName": "[parameters('playbook1-ConnectionName')]",
	    "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('workspace-location'), '/managedApis/azuresentinel')]"
          }
        }
      }
    }
  },
  "dependsOn": [
    "[resourceId('Microsoft.Web/connections', parameters('playbook1-ConnectionName'))]"
  ]
}
